/* ===========================
   CONFIG — EmailJS (remplis tes vrais IDs)
   =========================== */
const EMAILJS_PUBLIC_KEY  = "XgRStV-domSnc8RgY";      // clé publique
const EMAILJS_SERVICE_ID  = "service_8bw61yj";         // service id
const EMAILJS_TEMPLATE_ID = "template_9ok4wz8";        // template id

// Init EmailJS
if (window.emailjs) {
  emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
}

/* ===== Burger ===== */
const burgerBtn  = document.getElementById('burgerBtn');
const mobileMenu = document.getElementById('mobileMenu');

burgerBtn.addEventListener('click', () => {
  const open = mobileMenu.hasAttribute('hidden') ? false : true;
  if (open) {
    mobileMenu.setAttribute('hidden', '');
    burgerBtn.setAttribute('aria-expanded', 'false');
  } else {
    mobileMenu.removeAttribute('hidden');
    burgerBtn.setAttribute('aria-expanded', 'true');
  }
});

// Ferme le menu quand on clique un lien
document.querySelectorAll('.menu-link').forEach(a=>{
  a.addEventListener('click', ()=>{
    mobileMenu.setAttribute('hidden','');
    burgerBtn.setAttribute('aria-expanded','false');
  });
});

/* ===== Smooth scroll ===== */
document.querySelectorAll('a[href^="#"]').forEach(link=>{
  link.addEventListener('click', e=>{
    const id = link.getAttribute('href');
    if (id.length>1) {
      const el = document.querySelector(id);
      if (el) {
        e.preventDefault();
        el.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }
  });
});

/* ===== Carousel (1 slide visible, centré) ===== */
const track = document.querySelector('.carousel__track');
const slides = Array.from(document.querySelectorAll('.slide'));
const prev = document.querySelector('.carousel .prev');
const next = document.querySelector('.carousel .next');
let index = 0;

function updateCarousel(){
  const width = track.clientWidth || track.getBoundingClientRect().width;
  const offset = -index * width;
  track.style.transform = `translateX(${offset}px)`;
}

function go(dir){
  index += dir;
  if (index < 0) index = slides.length - 1;
  if (index > slides.length - 1) index = 0;
  updateCarousel();
}

window.addEventListener('resize', updateCarousel);
prev.addEventListener('click', ()=>go(-1));
next.addEventListener('click', ()=>go(1));
updateCarousel();

/* ===== “Choisir ce pack” => remplit le champ + scroll au formulaire ===== */
document.querySelectorAll('.choose-pack').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const pack = btn.dataset.pack || 'Site vitrine';
    const select = document.querySelector('#orderForm select[name="pack"]');
    if (select){
      Array.from(select.options).forEach(o=>{
        if (o.textContent.toLowerCase().includes(pack.toLowerCase())) o.selected = true;
      });
    }
    document.querySelector('#commande').scrollIntoView({behavior:'smooth'});
  });
});

/* ===== Formulaire EmailJS ===== */
const form = document.getElementById('orderForm');
const statusEl = document.getElementById('formStatus');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  statusEl.textContent = 'Envoi…';

  // Récupère “features” multiple sous forme de liste lisible
  const formData = new FormData(form);
  const features = formData.getAll('features').join(', ');

  const payload = {
    name:  formData.get('name') || '',
    email: formData.get('email') || '',
    phone: formData.get('phone') || '',
    pack:  formData.get('pack') || '',
    theme: formData.get('theme') || '',
    colors:formData.get('colors') || '',
    features, // <= joint
    domain: formData.get('domain') || '',
    public_contact: formData.get('public_contact') || '', // <= CORRIGÉ : bien transmis
    message: formData.get('message') || ''
  };

  try{
    if (!window.emailjs) throw new Error('EmailJS non chargé');
    const res = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload);
    statusEl.textContent = 'Message envoyé ✅';
    form.reset();
  }catch(err){
    console.error(err);
    statusEl.textContent = 'Erreur lors de l’envoi. Vérifie tes clés EmailJS.';
  }
});