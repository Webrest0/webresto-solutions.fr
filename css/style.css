/* === COORDONNÉES === */
const EMAIL = "smarttlelearning@gmail.com";
const PHONE_E164 = "+33788589812";

/* === MENU MOBILE === */
(function initMenu() {
  const btn = document.querySelector(".menu-toggle");
  if (!btn) return;
  btn.addEventListener("click", () => {
    document.body.classList.toggle("nav-open");
    btn.setAttribute(
      "aria-expanded",
      btn.getAttribute("aria-expanded") === "true" ? "false" : "true"
    );
  });
})();

/* === BOUTON APPELER (sécurisé) === */
(function initCallButtons() {
  document.querySelectorAll('a[href^="tel:"], .call-btn[data-phone]')
    .forEach((btn) => {
      const tel = btn.dataset.phone || PHONE_E164;
      btn.setAttribute("href", `tel:${tel}`);
    });
})();

/* === LIEN EMAIL (ouvre Gmail si dispo, sinon mailto) === */
(function initEmailButtons() {
  const mailLinks = document.querySelectorAll(".mail-btn, a[data-email]");
  mailLinks.forEach((a) => {
    const to = a.dataset.email || EMAIL;
    const subject = a.dataset.subject || "Projet de site web";
    const body =
      a.dataset.body ||
      "Bonjour,%0D%0A%0D%0AJe souhaite créer un site. Pouvez-vous me recontacter ?%0D%0A";
    // Lien Gmail (web / mobile), fallback mailto
    const gmailLink =
      `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(
        to
      )}&su=${encodeURIComponent(subject)}&body=${body}`;
    a.setAttribute("href", gmailLink);
    a.addEventListener("click", (e) => {
      // Sécurise un fallback si Gmail ne s’ouvre pas
      setTimeout(() => {
        // Si l’utilisateur est toujours sur la page (pas de navigation), on bascule sur mailto
        if (document.visibilityState === "visible") {
          window.location.href = `mailto:${to}?subject=${encodeURIComponent(
            subject
          )}&body=${body}`;
        }
      }, 1200);
    });
  });
})();

/* === CAROUSEL GÉNÉRIQUE ===
HTML attendu:
<div class="carousel">
  <button class="carousel-btn prev">‹</button>
  <div class="carousel-track">
    <div class="carousel-item"><img src="..."></div>
    ...
  </div>
  <button class="carousel-btn next">›</button>
</div>
*/
(function initCarousels() {
  const carousels = document.querySelectorAll(".carousel");
  carousels.forEach((root) => {
    const track = root.querySelector(".carousel-track");
    if (!track) return;
    const items = Array.from(track.children);
    const prev = root.querySelector(".carousel-btn.prev");
    const next = root.querySelector(".carousel-btn.next");
    let index = 0;

    function update() {
      const offset = -index * 100;
      track.style.transform = `translateX(${offset}%)`;
    }

    function go(step) {
      index = (index + step + items.length) % items.length;
      update();
    }

    prev && prev.addEventListener("click", () => go(-1));
    next && next.addEventListener("click", () => go(1));

    // Swipe tactile
    let startX = 0;
    let delta = 0;
    track.addEventListener(
      "touchstart",
      (e) => {
        startX = e.touches[0].clientX;
        delta = 0;
      },
      { passive: true }
    );
    track.addEventListener(
      "touchmove",
      (e) => {
        delta = e.touches[0].clientX - startX;
      },
      { passive: true }
    );
    track.addEventListener("touchend", () => {
      if (Math.abs(delta) > 40) {
        go(delta < 0 ? 1 : -1);
      }
    });

    // Resize guard (si des images chargent plus tard)
    window.addEventListener("resize", update);
    update();
  });
})();

/* === FOND HÉRO (image fournie via data-bg-src) ===
   Exemple dans le HTML:
   <section class="hero" data-bg-src="images/hero-dark-office.png"> ... </section>
*/
(function initHeroBg() {
  const hero = document.querySelector(".hero");
  if (!hero) return;
  const src = hero.dataset.bgSrc;
  if (src) {
    const img = new Image();
    img.onload = () => (hero.style.backgroundImage = `url('${src}')`);
    img.src = src;
  }
})();